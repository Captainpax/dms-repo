# ğŸ§¼ Base FXServer image
FROM routmoute/fxserver:recommended

# ğŸ‘¤ Metadata
LABEL maintainer="Antimatter Zone LLC"
LABEL org.opencontainers.image.source="https://github.com/Captainpax/dms-repo"

# âš™ï¸ Environment
ENV HOME=/home/container
WORKDIR ${HOME}

# ğŸ‘‘ Become root to modify image
USER root

# ğŸ“¦ Download working Node.js binary from official Alpine Node image
RUN mkdir -p /tmp/node && \
    wget -qO- https://unofficial-builds.nodejs.org/download/release/v20.11.1/node-v20.11.1-linux-x64-musl.tar.gz \
    | tar -xz -C /tmp/node --strip-components=1 && \
    cp /tmp/node/bin/node /usr/local/bin/node && \
    cp /tmp/node/bin/npm /usr/local/bin/npm && \
    rm -rf /tmp/node

# ğŸ“‚ Copy your files into the container
COPY dockers/games/gtav/fivem/home/container/ ${HOME}/

# âœ… Set permissions (use existing 'cfx' user/group: 1000:1000)
RUN chmod +x ${HOME}/initmain.mjs && \
    chown -R cfx:cfx ${HOME}

# ğŸŒ Expose common FXServer and txAdmin ports
EXPOSE 30120/tcp 30120/udp
EXPOSE 40120/tcp 40120/udp

# ğŸ©º Optional: Pterodactyl panel healthcheck
HEALTHCHECK --interval=30s --timeout=5s --start-period=30s CMD test -x ${HOME}/initmain.mjs

# ğŸ‘¤ Run as Pterodactyl-compatible user
USER cfx

# ğŸš€ Entrypoint
ENTRYPOINT ["node", "--no-warnings", "--enable-source-maps", "/home/container/initmain.mjs"]
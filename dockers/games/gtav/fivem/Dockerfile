# ğŸ§± Base image with FXServer
FROM routmoute/fxserver:recommended

# ğŸ§° Install Node.js and npm from Alpine packages
RUN apk add --no-cache nodejs npm

# ğŸ“‚ Copy project files into container
COPY dockers/games/gtav/fivem/home/container/ /home/container/

# ğŸ“¦ Run npm install if package.json is present
RUN [ -f /home/container/package.json ] && \
    npm --prefix /home/container install --omit=dev || \
    echo "âš ï¸  Skipping npm install (no package.json found)"

# ğŸ” Set permissions (allow chown to fail on some host FS like Windows)
RUN chmod +x /home/container/initmain.mjs && \
    chown -R cfx:cfx /home/container || \
    echo "âš ï¸  chown failed (possibly due to Docker volume bind permissions)"

# ğŸ‘¤ Switch to non-root user required by Pterodactyl
USER cfx

# ğŸš€ Default startup command
CMD ["node", "--no-warnings", "--enable-source-maps", "/home/container/initmain.mjs"]
